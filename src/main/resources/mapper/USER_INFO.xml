<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ng.temp1.mapper.UserInfoMapper">
	<sql id="selectColumns">
		usi.USI_NUM,		usi.USI_ID,		usi.CUI_NUM,		usi.MAI_NUM,		usi.SHI_NUM,		usi.USI_PWD
,		usi.LAST_LOGIN,		usi.LAST_CHANGE_PWDDAT,		DATE_FORMAT(usi.CREDAT,'%Y-%m-%d') AS CREDAT,		TIME_FORMAT(usi.CRETIM,'%H:%i:%S') AS CRETIM,		usi.CREUSR
,		DATE_FORMAT(usi.MODDAT,'%Y-%m-%d') AS MODDAT,		TIME_FORMAT(usi.MODTIM,'%H:%i:%S') AS MODTIM,		usi.MODUSR,		usi.ACTIVE	
	</sql>
	
	<select id="test" resultType="usi2">
		SELECT * FROM user_info
		WHERE usi_num= #{usiNum}
	</select>
	
	
	<select id="selectUSIList" resultType="usi">
		SELECT <include refid="selectColumns"></include> FROM
		USER_INFO usi  left join CUSTOMER_INFO cui on cui.CUI_NUM=usi.CUI_NUM left join MARKETER_INFO mai on mai.MAI_NUM=usi.MAI_NUM left join SHOP_INFO shi on shi.SHI_NUM=usi.SHI_NUM		
		<where>
			<if test='usiNum != null and usiNum != ""'>
 				AND usi.USI_NUM like concat('%',#{usiNum},'%')
			</if>
			<if test='usiId != null and usiId != ""'>
 				AND usi.USI_ID like concat('%',#{usiId},'%')
			</if>
			<if test='cuiNum != null and cuiNum != ""'>
 				AND usi.CUI_NUM = #{cuiNum}
			</if>
			<if test='maiNum != null and maiNum != ""'>
 				AND usi.MAI_NUM = #{maiNum}
			</if>
			<if test='shiNum != null and shiNum != ""'>
 				AND usi.SHI_NUM = #{shiNum}
			</if>
			<if test='usiPwd != null and usiPwd != ""'>
 				AND usi.USI_PWD like concat('%',#{usiPwd},'%')
			</if>
			<if test='lastLogin != null and lastLogin != ""'>
 				AND usi.LAST_LOGIN like concat('%',#{lastLogin},'%')
			</if>
			<if test='lastChangePwddat != null and lastChangePwddat != ""'>
 				AND usi.LAST_CHANGE_PWDDAT like concat('%',#{lastChangePwddat},'%')
			</if>
			<if test='credat != null and credat != ""'>
 				AND usi.CREDAT like concat('%',replace(#{credat},'-',''),'%')
			</if>
			<if test='cretim != null and cretim != ""'>
 				AND usi.CRETIM like concat('%',#{cretim},'%')
			</if>
			<if test='creusr != null and creusr != ""'>
 				AND usi.CREUSR = #{creusr}
			</if>
			<if test='moddat != null and moddat != ""'>
 				AND usi.MODDAT like concat('%',replace(#{moddat},'-',''),'%')
			</if>
			<if test='modtim != null and modtim != ""'>
 				AND usi.MODTIM like concat('%',#{modtim},'%')
			</if>
			<if test='modusr != null and modusr != ""'>
 				AND usi.MODUSR = #{modusr}
			</if>
			<if test='active != null and active != ""'>
 				AND usi.ACTIVE like concat('%',#{active},'%')
			</if>
		</where>
		<trim prefix="order by">
	    	<if test="orders!=null">
	    		${orders}
	    	</if>
	    </trim>
	    
	</select>
	<select id="selectUSI" resultType="usi">
		SELECT <include refid="selectColumns"></include> FROM USER_INFO usi  left join CUSTOMER_INFO cui on cui.CUI_NUM=usi.CUI_NUM left join MARKETER_INFO mai on mai.MAI_NUM=usi.MAI_NUM left join SHOP_INFO shi on shi.SHI_NUM=usi.SHI_NUM
		WHERE USI_NUM = #{usiNum}
	</select>
	<insert id="insertUSI" useGeneratedKeys="true" keyProperty="usiNum" keyColumn="USI_NUM">
		INSERT INTO USER_INFO	
		(
 			<if test="usiId != null and usiId != '' ">  USI_ID,</if>
			<if test="usiPwd != null and usiPwd != '' ">  USI_PWD,</if>
			<if test="lastLogin != null and lastLogin != '' ">  LAST_LOGIN,</if>
			<if test="lastChangePwddat != null and lastChangePwddat != '' ">  LAST_CHANGE_PWDDAT,</if>
			<if test="active != null and active != '' ">  ACTIVE,</if>
	CUI_NUM,
	MAI_NUM,
	SHI_NUM,
	CREDAT,	CRETIM,	CREUSR,
	MODDAT,	MODTIM,	MODUSR)
		VALUES(
 			<if test="usiId != null and usiId != '' ">  #{usiId},</if>
			<if test="usiPwd != null and usiPwd != '' ">  #{usiPwd},</if>
			<if test="lastLogin != null and lastLogin != '' ">  #{lastLogin},</if>
			<if test="lastChangePwddat != null and lastChangePwddat != '' ">  #{lastChangePwddat},</if>
			<if test="active != null and active != '' ">  #{active},</if>
		#{cuiNum},
		#{maiNum},
		#{shiNum},
		DATE_FORMAT(NOW(),'%Y%m%d'),		DATE_FORMAT(NOW(),'%H%i%S'),		#{creusr},
		DATE_FORMAT(NOW(),'%Y%m%d'),		DATE_FORMAT(NOW(),'%H%i%S'),		#{modusr})
	</insert>
	
	<update id="updateUSI">
		UPDATE USER_INFO usi 
		<set>
			<if test="usiId != null and usiId != '' ">  USI_ID = #{usiId},</if>
			<if test="cuiNum != null and cuiNum != '' ">  CUI_NUM = #{cuiNum},</if>
			<if test="maiNum != null and maiNum != '' ">  MAI_NUM = #{maiNum},</if>
			<if test="shiNum != null and shiNum != '' ">  SHI_NUM = #{shiNum},</if>
			<if test="usiPwd != null and usiPwd != '' ">  USI_PWD = #{usiPwd},</if>
			<if test="lastLogin != null and lastLogin != '' ">  LAST_LOGIN = #{lastLogin},</if>
			<if test="lastChangePwddat != null and lastChangePwddat != '' ">  LAST_CHANGE_PWDDAT = #{lastChangePwddat},</if>
			<if test="creusr != null and creusr != '' ">  CREUSR = #{creusr},</if>
			<if test="modusr != null and modusr != '' ">  MODUSR = #{modusr},</if>
			<if test="active != null and active != '' ">  ACTIVE = #{active},</if>
			MODDAT = DATE_FORMAT(NOW(),'%Y%m%d'),
			MODTIM = DATE_FORMAT(NOW(),'%H%i%S')
		</set>
		WHERE  usi.USI_NUM  = #{usiNum}
	</update>
	
	<delete id="deleteUSI">
		UPDATE USER_INFO	
		SET ACTIVE=0,
		MODDAT = DATE_FORMAT(NOW(),'%Y%m%d'),
		MODTIM = DATE_FORMAT(NOW(),'%H%i%S')
		WHERE  USI_NUM  = #{usiNum}
	</delete>
</mapper>